<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC
        "-//Hibernate/Hibernate Mapping DTD//EN"
        "http://hibernate.sourceforge.net/hibernate-mapping-2.0.dtd">

<hibernate-mapping>
    <class name="org.ibit.rol.sac.model.Normativa" table="RSC_NORMAT" discriminator-value="normativa">
        <cache usage="read-write"/>
        <id name="id" unsaved-value="null" column="NOR_CODI">
            <generator class="sequence">
                <param name="sequence">RSC_SEQ_ALL</param>
            </generator>
        </id>

        <discriminator column="NOR_TYPEN" type="string" length="64" />
		
        <property name="numero" column="NOR_NUMERO"/>
        <property name="registro" column="NOR_REGIST"/>
        <property name="ley" length="256" column="NOR_LEY"/>
        <property name="fecha" column="NOR_FECHA"/>
        <property name="fechaBoletin" column="NOR_FECBOL"/>
        <property name="validacion" column="NOR_VALIDN"/>
        <property name="codiVuds" column="NOR_CODIVUDS"/>
        <property name="descCodiVuds" column="NOR_DESCCODIVUDS"/>
        <property name="numNormativa" column="NOR_NUMNOR" />
        
        <set name="unidadesnormativas" cascade="all" inverse="true" >
            <key column="UNN_CODNOR" foreign-key="RSC_UNNNOR_FK"/>
            <one-to-many class="org.ibit.rol.sac.model.UnidadNormativa" />
        </set>
        
        <set name="documentos" cascade="all-delete-orphan" inverse="true" lazy="true" order-by="ORDEN">
            <cache usage="read-write"/>
            <key column="DNO_CODNOR" foreign-key="DNO_CODNOR_FK"/>
            <one-to-many class="org.ibit.rol.sac.model.DocumentoNormativa"/>
        </set>

        <set name="afectadas" table="RSC_AFECTA" cascade="none" lazy="true">
            <cache usage="read-write"/>
            <key column="AFE_CODNOR" foreign-key="RSC_AFENOR_FK"/>
            <composite-element class="org.ibit.rol.sac.model.Afectacion">
                <parent name="afectante" />
                <many-to-one name="normativa" column="AFE_CODNOA" foreign-key="RSC_AFENOA_FK"/>
                <many-to-one name="tipoAfectacion" column="AFE_CODTIA" foreign-key="RSC_AFETIA_FK"/>
            </composite-element>
        </set>

        <set name="afectantes" table="RSC_AFECTA" cascade="none" inverse="true" lazy="true">
            <cache usage="read-write"/>
            <key column="AFE_CODNOA" foreign-key="RSC_AFENOA_FK"/>
            <composite-element class="org.ibit.rol.sac.model.Afectacion">
                <parent name="normativa" />
                <many-to-one name="afectante" column="AFE_CODNOR" foreign-key="RSC_AFENOR_FK"/>
                <many-to-one name="tipoAfectacion" column="AFE_CODTIA" foreign-key="RSC_AFETIA_FK"/>
            </composite-element>
        </set>

        <many-to-one name="boletin" column="NOR_CODBOL" foreign-key="RSC_NORBOL_FK"/>
        <many-to-one name="tipo" column="NOR_CODTIP" foreign-key="RSC_NORTIP_FK"/>

        <set name="procedimientos" table="RSC_PRONOR" inverse="true" lazy="true">
            <cache usage="read-write"/>
            <key column="PRN_CODNOR" foreign-key="RSC_PRNNOR_FK"/>
            <many-to-many class="org.ibit.rol.sac.model.ProcedimientoLocal" column="PRN_CODPRO" foreign-key="RSC_PRNPRO_FK" />
        </set>
        
        <set name="servicios" table="RSC_SERNOR" inverse="true" lazy="true">
            <cache usage="read-write"/>
            <key column="SRN_CODNOR" foreign-key="RSC_SRNNOR_FK"/>
            <many-to-many class="org.ibit.rol.sac.model.Servicio" column="SRN_CODSER" foreign-key="RSC_SRNNOR_FK" />
        </set>

		<!--  Traducciones sin combinar. -->
		<map name="traducciones" cascade="all" table="RSC_TRANOR">
            <cache usage="read-write"/>
            <key column="TNO_CODNOR" foreign-key="RSC_TNONOR_FK"/>
            <index column="TNO_CODIDI" type="string" length="2" />
            <composite-element class="org.ibit.rol.sac.model.TraduccionNormativa">
                <property name="seccion" length="256" column="TNO_SECCIO" />
                <property name="apartado" length="256" column="TNO_APARTA" />
                <property name="paginaInicial" column="TNO_PAGINI" />
                <property name="paginaFinal" column="TNO_PAGFIN" />
                <property name="titulo" length="1024" column="TNO_TITULO" />
                <property name="enlace" length="512" column="TNO_ENLACE" />
                <property name="responsable" length="512" column="TNO_RESPON" />
                <!-- many-to-one  cascade="all" name="archivo" column="TNO_CODARC" / -->
                <property name="observaciones" length="4000" column="TNO_OBSERV" />
            </composite-element>
        </map>
                
        <subclass name="org.ibit.rol.sac.model.NormativaRemota" discriminator-value="normativaRemota">
            <property name="idExterno" column="NER_IDEXTE"/>
            <property name="urlRemota" length="512" column="NER_URLREM"/>
            <many-to-one name="administracionRemota" column="NER_CODADM" foreign-key="RSC_NERADM_FK" />
        </subclass>
        
    </class>
</hibernate-mapping>