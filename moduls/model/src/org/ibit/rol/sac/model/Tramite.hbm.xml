<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC
        "-//Hibernate/Hibernate Mapping DTD//EN"
        "http://hibernate.sourceforge.net/hibernate-mapping-2.0.dtd">

<hibernate-mapping>
    <class name="org.ibit.rol.sac.model.Tramite" table="RSC_TRAMIT" discriminator-value="tramite">
        <cache usage="read-write"/>
        <id name="id" unsaved-value="null" column="TRA_CODI">
            <generator class="sequence">
                <param name="sequence">RSC_SEQ_ALL</param>
            </generator>
        </id>

        <discriminator column="TRA_TYPE" type="string" length="64"/>

        <property name="fase" column="TRA_FASE"/>
        <property name="orden" column="TRA_ORDEN"/>

        <property name="telematico" column="TRA_CTELEM" />
        <property name="presencial" column="TRA_CPRESE" />

        <many-to-one name="procedimiento" column="TRA_CODPRO" foreign-key="RSC_TRAPRO_FK"/>


        <map name="traducciones" cascade="all" table="RSC_TRATRA">
            <cache usage="read-write"/>
            <key column="TTR_CODTTR" foreign-key="RSC_TTRTRA_FK"/>
            <index column="TTR_CODIDI" type="string" length="2"/>
            <composite-element class="org.ibit.rol.sac.model.TraduccionTramite">
                <property name="nombre" length="256" column="TTR_NOMBRE"/>
                <!--                 #351 se cambia descripciÃ³n por observaciones -->
                <property name="observaciones" type="text" column="TTR_DESCRI"/>
                <property name="documentacion" type="text" column="TTR_DOCUME"/>
                <property name="requisits" type="text" column="TTR_REQUI"/>
                <property name="plazos" length="512" column="TTR_PLAZOS"/>
                <property name="lugar" length="512" column="TTR_LUGAR"/>
                <property name="urlTramiteExterno"	length="256" 	column="TTR_ULRTRA" />
            </composite-element>
        </map>

		<property name="codiVuds" column="TRA_CODIVUDS"/>
		<property name="descCodiVuds" column="TRA_DESCCODIVUDS"/>
		<property name="validacio" column="TRA_VALIDA"/>
        <property name="dataCaducitat" column="TRA_DATCADU"/>
        <property name="dataPublicacio" column="TRA_DATPUBL"/>
        <property name="dataActualitzacio" column="TRA_DATACTU"/>
        <property name="idTraTel" column="TRA_IDTRAMTEL"/>
        <property name="versio" column="TRA_VERSIO"/>
   <!--      <property name="urlExterna" column="TRA_URLEXTE"/> -->
        <property name="dataActualitzacioVuds" column="TRA_DATACTUVUDS"/>
        <property name="dataInici" column="TRA_DATINICI"/>
        <property name="dataTancament" column="TRA_DATTANCAMENT"/>
        <property name="parametros" column="TRA_PARAMS"/>

        <many-to-one name="plataforma" cascade="none" column="TRA_CODPLT" foreign-key="RSC_TRAMPLT_FK"/>
		<many-to-one name="tramitePlantilla" cascade="none" column="TRA_CODPLN" foreign-key="RSC_TRAMPLN_FK"/>

        <many-to-one name="organCompetent" column="TRA_ORGCOMP" foreign-key="RSC_ORGCOMP_FK"/>



        <set name="docsInformatius" cascade="all-delete-orphan" inverse="true" lazy="true" where="DTR_TIPUS = 0" order-by="DTR_ORDEN">
            <cache usage="read-write"/>
            <key column="DTR_CODTRA" foreign-key="RSC_CODITRA_FK"/>
            <one-to-many class="org.ibit.rol.sac.model.DocumentTramit"/>
        </set>

        <set name="formularios" cascade="all-delete-orphan" inverse="true" lazy="true" where="DTR_TIPUS = 1" order-by="DTR_ORDEN">

            <cache usage="read-write"/>
            <key column="DTR_CODTRA" foreign-key="RSC_CODITRA_FK"/>
            <one-to-many class="org.ibit.rol.sac.model.DocumentTramit"/>
        </set>

		<set name="docsRequerits" cascade="all-delete-orphan" inverse="true" lazy="true" where="DTR_TIPUS = 2" order-by="DTR_ORDEN">
            <cache usage="read-write"/>
            <key column="DTR_CODTRA" foreign-key="RSC_CODITRA_FK"/>
            <one-to-many class="org.ibit.rol.sac.model.DocumentTramit"/>
        </set>

        <set name="taxes" cascade="all-delete-orphan" inverse="true" lazy="true">
            <cache usage="read-write"/>
            <key column="TAX_CODTRA" foreign-key="RSC_TAXTRA_FK"/>
            <one-to-many class="org.ibit.rol.sac.model.Taxa"/>
        </set>


        <!--  OK
        <set name="docsPresentar" cascade="delete" table="RSC_TRADOCPRE">
            <cache usage="read-write"/>
            <key column="TDP_CODI"/>
            <element column="TDP_DOCU" type="string" />
        </set>
        -->
        <subclass name="org.ibit.rol.sac.model.TramiteRemoto" discriminator-value="tramiteRemoto">

            <property name="idExterno" column="TRR_IDEXTE"/>
            <property name="urlRemota" length="512" column="TRR_URLREM"/>
            <many-to-one name="administracionRemota" column="TRR_CODADM" foreign-key="RSC_TRRADM_FK" />
        </subclass>


    </class>
</hibernate-mapping>