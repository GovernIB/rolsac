<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC
        "-//Hibernate/Hibernate Mapping DTD//EN"
        "http://hibernate.sourceforge.net/hibernate-mapping-2.0.dtd">

<hibernate-mapping>
    <class name="org.ibit.rol.sac.model.Tramite" table="RSC_TRAMIT" discriminator-value="tramite">
        <cache usage="read-write"/>
        <id name="id" unsaved-value="null" column="TRA_CODI">
            <generator class="sequence">
                <param name="sequence">RSC_SEQ_ALL</param>
            </generator>
        </id>

        <discriminator column="TRA_TYPE" type="string" length="64"/>

        <property name="fase" column="TRA_FASE"/>
        <property name="orden" column="TRA_ORDEN"/>

        <many-to-one name="procedimiento" column="TRA_CODPRO" foreign-key="RSC_TRAPRO_FK"/>


        <map name="traducciones" cascade="all" table="RSC_TRATRA">
            <cache usage="read-write"/>
            <key column="TTR_CODTTR" foreign-key="RSC_TTRTRA_FK"/>
            <index column="TTR_CODIDI" type="string" length="2"/>
            <composite-element class="org.ibit.rol.sac.model.TraduccionTramite">
                <property name="nombre" length="256" column="TTR_NOMBRE"/>
                <property name="descripcion" type="@clob.type@" column="TTR_DESCRI"/>
                <property name="documentacion" type="@clob.type@" column="TTR_DOCUME"/>
                <property name="requisits" type="@clob.type@" column="TTR_REQUI"/>
                <property name="plazos" length="512" column="TTR_PLAZOS"/>
                <property name="lugar" length="512" column="TTR_LUGAR"/>
            </composite-element>
        </map>

		<property name="codiVuds" column="TRA_CODIVUDS"/>
		<property name="descCodiVuds" column="TRA_DESCCODIVUDS"/>
		<property name="validacio" column="TRA_VALIDA"/>
        <property name="dataCaducitat" column="TRA_DATCADU"/>
        <property name="dataPublicacio" column="TRA_DATPUBL"/>
        <property name="dataActualitzacio" column="TRA_DATACTU"/>
        <property name="idTraTel" column="TRA_IDTRAMTEL"/>
        <property name="versio" column="TRA_VERSIO"/>
        <property name="urlExterna" column="TRA_URLEXTE"/>
        <property name="dataActualitzacioVuds" column="TRA_DATACTUVUDS"/>
        
        <many-to-one name="organCompetent" column="TRA_ORGCOMP" foreign-key="RSC_ORGCOMP_FK"/>
        
        

        <set name="docsInformatius" cascade="all-delete-orphan" inverse="true" lazy="true" where="TIPUS = 0" order-by="ORDEN">
            <cache usage="read-write"/>
            <key column="CODITRA" foreign-key="RSC_CODITRA_FK"/>
            <one-to-many class="org.ibit.rol.sac.model.DocumentTramit"/>
        </set>

        <set name="formularios" cascade="all-delete-orphan" inverse="true" lazy="true" where="TIPUS = 1" order-by="ORDEN">

            <cache usage="read-write"/>
            <key column="CODITRA" foreign-key="RSC_CODITRA_FK"/>
            <one-to-many class="org.ibit.rol.sac.model.DocumentTramit"/>
        </set>

		<set name="docsRequerits" cascade="all-delete-orphan" inverse="true" lazy="true" where="TIPUS = 2" order-by="ORDEN">
            <cache usage="read-write"/>
            <key column="CODITRA" foreign-key="RSC_CODITRA_FK"/>
            <one-to-many class="org.ibit.rol.sac.model.DocumentTramit"/>
        </set>

        <set name="taxes" cascade="all-delete-orphan" inverse="true" lazy="true">
            <cache usage="read-write"/>
            <key column="TAX_CODTRA" foreign-key="RSC_TAXTRA_FK"/>
            <one-to-many class="org.ibit.rol.sac.model.Taxa"/>
        </set>


        <!--  OK 
        <set name="docsPresentar" cascade="delete" table="RSC_TRADOCPRE"> 
            <cache usage="read-write"/>
            <key column="TDP_CODI"/>
            <element column="TDP_DOCU" type="string" />
        </set>
        -->
        <subclass name="org.ibit.rol.sac.model.TramiteRemoto" discriminator-value="tramiteRemoto">
        
            <property name="idExterno" column="TRR_IDEXTE"/>
            <property name="urlRemota" length="512" column="TRR_URLREM"/>
            <many-to-one name="administracionRemota" column="TRR_CODADM" foreign-key="RSC_TRRADM_FK" />
        </subclass>
       

    </class>
</hibernate-mapping>